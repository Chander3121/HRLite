<h1 class="text-2xl font-bold mb-6">My Attendance</h1>

<div class="bg-white rounded-xl shadow p-6 mb-6">
  <%= form_with url: attendances_path,
                method: :get,
                local: true,
                class: "flex gap-4 items-end" do %>

    <div>
      <label class="block text-sm font-medium text-gray-700">Month</label>
      <%= month_field_tag :month,
          @month.strftime("%Y-%m"),
          class: "mt-1 rounded-lg border-gray-300" %>
    </div>

    <%= submit_tag "View",
        class: "px-4 py-2 bg-indigo-600 text-white rounded-lg" %>
  <% end %>
</div>

<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
  <div class="bg-white rounded-xl shadow p-4">
    <p class="text-sm text-gray-500">Working Days</p>
    <p class="text-2xl font-bold"><%= @total_working_days %></p>
  </div>

  <div class="bg-white rounded-xl shadow p-4">
    <p class="text-sm text-gray-500">Present</p>
    <p class="text-2xl font-bold text-green-600">
      <%= @summary[:present] %>
    </p>
  </div>

  <div class="bg-white rounded-xl shadow p-4">
    <p class="text-sm text-gray-500">Short Working</p>
    <p class="text-2xl font-bold text-yellow-600">
      <%= @summary[:short_working] %>
    </p>
  </div>

  <div class="bg-white rounded-xl shadow p-4">
    <p class="text-sm text-gray-500">Half Days</p>
    <p class="text-2xl font-bold text-orange-600">
      <%= @summary[:half_day] %>
    </p>
  </div>

  <div class="bg-white rounded-xl shadow p-4">
    <p class="text-sm text-gray-500">Absent</p>
    <p class="text-2xl font-bold text-red-600">
      <%= @summary[:absent] %>
    </p>
  </div>

  <div class="bg-white rounded-xl shadow p-4">
    <p class="text-sm text-gray-500">Holidays</p>
    <p class="text-2xl font-bold text-blue-600">
      <%= @summary[:holiday] %>
    </p>
  </div>

  <div class="bg-white rounded-xl shadow p-4">
    <p class="text-sm text-gray-500">Weekends</p>
    <p class="text-2xl font-bold text-gray-600">
      <%= @summary[:weekly_off] %>
    </p>
  </div>
</div>

<div class="bg-white rounded-xl shadow overflow-x-auto">
  <table class="min-w-full text-sm">
    <thead class="bg-gray-50">
      <tr>
        <th class="px-4 py-3">Date</th>
        <th class="px-4 py-3">Day</th>
        <th class="px-4 py-3">Check In</th>
        <th class="px-4 py-3">Check Out</th>
        <th class="px-4 py-3">Worked Hrs</th>
        <th class="px-4 py-3">Status</th>
        <th class="px-4 py-3">Action</th>
      </tr>
    </thead>

    <tbody class="divide-y">
      <% (@month.beginning_of_month..@month.end_of_month).each do |date| %>
        <% attendance = @records[date] %>

        <tr>
          <td class="px-4 py-2 text-center"><%= date.strftime("%d %b %Y") %></td>
          <td class="px-4 py-2 text-center"><%= date.strftime("%A") %></td>

          <td class="px-4 py-2 text-center">
            <%= attendance&.check_in&.strftime("%I:%M %p") || "—" %>
          </td>

          <td class="px-4 py-2 text-center">
            <%= attendance&.check_out&.strftime("%I:%M %p") || "—" %>
          </td>

          <td class="px-4 py-2 text-center">
            <%= attendance&.worked_minutes ?
                (attendance.worked_minutes.to_f / 60).round(2) :
                "—" %>
          </td>

          <td class="px-4 py-2 text-center">
            <% if attendance %>
              <span class="px-2 py-1 rounded-full text-xs font-medium
                <%= attendance_status_color(attendance.status) %>">
                <%= attendance.status.titleize %>
              </span>
            <% else %>
              —
            <% end %>
          </td>
          <td class="px-4 py-2">
            <% if !["Sunday", "Saturday"].include?(date.strftime("%A")) && (attendance.nil? || attendance.absent?) %>
              <%= link_to "Regularize",
                  new_attendance_regularization_path(date: date),
                  class: "text-indigo-600 text-sm hover:underline" %>
            <% else %>
              —
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
