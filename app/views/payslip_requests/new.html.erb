<h1 class="text-2xl font-bold mb-6">Request Payslip</h1>

<% requested_months = current_user
     .payslip_requests
     .pluck(:month)
     .map { |m| m.strftime("%Y-%m") } %>

<div class="bg-white rounded-xl shadow p-6 max-w-lg">
  <%= form_with model: @request,
                data: { turbo: false },
                class: "space-y-6",
                id: "payslip-form" do |f| %>

    <!-- Hidden field that actually submits -->
    <%= f.hidden_field :month, id: "selected-month" %>

    <div>
      <label class="block text-sm font-medium text-gray-700 mb-3">
        Select Month
      </label>

      <div class="grid grid-cols-3 gap-3" id="month-picker"
           data-disabled-months="<%= requested_months.join(",") %>">

        <% start = Date.current.beginning_of_month - 11.months %>
        <% 12.times do |i| %>
          <% month = (start + i.months) %>
          <% value = month.strftime("%Y-%m") %>

          <button type="button"
            data-month="<%= value %>"
            class="month-btn px-3 py-2 rounded-lg border text-sm font-medium
              <%= requested_months.include?(value) ?
                'bg-gray-100 text-gray-400 cursor-not-allowed' :
                'bg-white hover:bg-indigo-50 text-gray-700' %>"
            <%= "disabled" if requested_months.include?(value) %>>
            <%= month.strftime("%b %Y") %>
          </button>
        <% end %>
      </div>
    </div>

    <div class="flex justify-end gap-3">
      <%= link_to "Cancel",
          payslip_requests_path,
          class: "px-4 py-2 border rounded-lg text-gray-600" %>

      <%= f.submit "Submit Request",
          class: "px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",
          disabled: true,
          id: "submit-btn" %>
    </div>
  <% end %>
</div>
