<nav class="bg-white border-b">
  <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
    <!-- Logo -->
    <h1 class="text-xl font-bold text-indigo-600">
      <%= link_to "HRLite", root_path %>
    </h1>

    <!-- Right section -->
    <div class="flex items-center gap-6">
      <% if user_signed_in? %>

        <!-- MAIN MENU DROPDOWN -->
        <div class="relative" data-controller="dropdown">
          <button
            data-action="click->dropdown#toggle"
            class="text-sm font-medium text-gray-700 hover:text-indigo-600 flex items-center gap-1">
            Menu
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M19 9l-7 7-7-7" />
            </svg>
          </button>

          <div
            data-dropdown-target="menu"
            class="hidden absolute right-0 mt-2 w-56 bg-white border rounded-xl shadow-lg py-2 text-sm z-50">

            <% if current_user.admin? %>
              <%= link_to "Payslip Requests",
                  admin_payslip_requests_path,
                  class: "block px-4 py-2 hover:bg-gray-50" %>

              <%= link_to "Attendance Regularizations",
                  admin_attendance_regularizations_path,
                  class: "block px-4 py-2 hover:bg-gray-50" %>
            <% end %>

            <% if current_user.employee? %>
              <%= link_to "My Attendance",
                  attendances_path,
                  class: "block px-4 py-2 hover:bg-gray-50" %>

              <%= link_to "Payslips",
                  payslip_requests_path,
                  class: "block px-4 py-2 hover:bg-gray-50" %>

              <%= link_to "Apply Leave",
                  new_leave_request_path,
                  class: "block px-4 py-2 hover:bg-gray-50" %>

              <%= link_to "My Leaves",
                  leave_requests_path,
                  class: "block px-4 py-2 hover:bg-gray-50" %>
            <% end %>
          </div>
        </div>

        <!-- USER DROPDOWN -->
        <div class="relative" data-controller="dropdown">
          <button
            data-action="click->dropdown#toggle"
            class="flex items-center gap-2 text-sm text-gray-700 hover:text-indigo-600">

            <!-- Profile Image -->
            <% profile = current_user.employee_profile %>
            <% if profile&.persisted? && profile.profile_picture.attached? && profile.profile_picture.blob.persisted?  %>
              <%= image_tag(
                  profile.profile_picture.variant(resize_to_fill: [32, 32]),
                  class: "w-8 h-8 rounded-full object-cover border"
                ) 
              %>
            <% else %>
              <div class="w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center text-xs font-semibold text-gray-600">
                <%= current_user.employee_profile&.first_name&.first || current_user.email.first.upcase %>
              </div>
            <% end %>

            <!-- User Name -->
            <span class="font-medium">
              <%= current_user.employee_profile&.first_name || current_user.email %>
            </span>

            <!-- Dropdown Icon -->
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M19 9l-7 7-7-7" />
            </svg>
          </button>

          <div
            data-dropdown-target="menu"
            class="hidden absolute right-0 mt-2 w-48 bg-white border rounded-xl shadow-lg py-2 text-sm z-50">

            <% if current_user.employee? %>
              <%= link_to "My Profile",
                  edit_profile_path,
                  class: "block px-4 py-2 hover:bg-gray-50" %>

              <%= link_to "My ID card",
                  my_id_card_profile_path,
                  class: "block px-4 py-2 hover:bg-gray-50" %>
            <% end %>

            <div class="border-t my-1"></div>

            <%= button_to "Logout",
                destroy_user_session_path,
                method: :delete,
                class: "w-full text-left px-4 py-2 text-red-600 hover:bg-red-50" %>
          </div>
        </div>
      <% else %>
        <%= link_to "Login",
            new_user_session_path,
            class: "text-indigo-600 font-medium hover:underline" %>
      <% end %>
    </div>
  </div>
</nav>
